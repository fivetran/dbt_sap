{{ config(enabled=var('sap_using_ekpo', True)) }}

select
    mandt as client_id,
    ebeln as purchasing_document_id,
    ebelp as purchasing_document_item_id,
    loekz as deletion_indicator,
    statu as rfq_status,
    {{ char_yyyymmdd_to_date('aedat') }} as last_changed_on_date,
    txz01 as short_text,
    matnr as material_id,
    ematn as material_number_id,
    bukrs as company_code_id,
    werks as plant_id,
    lgort as storage_location_id,
    bednr as requirement_tracking_number,
    matkl as material_group_id,
    infnr as number_purchasing_info_id,
    idnlf as material_number_used_by_vendor,
    ktmng as target_quantity,
    menge as purchase_order_quantity,
    meins as order_uom_id,
    bprme as order_price_purchasing_uom_id,
    bpumz as quantity_conversion,
    bpumn as bpumn,
    umrez as equal_to,
    umren as denominator,
    netpr as net_order_price_val,
    peinh as price_unit,
    netwr as net_order_po_currency_val,
    brtwr as gross_order_po_currency_val,
    {{ char_yyyymmdd_to_date('agdat') }} as quotation_deadline_date,
    webaz as gr_processing_time,
    mwskz as tax_code_id,
    bonus as settlement_group_1_purchasing,
    insmk as stock_type,
    spinf as indicator_update_info,
    prsdr as price_printout,
    schpr as indicator_estimated_price,
    mahnz as number_reminders_expediters,
    mahn1 as _1st_reminder_exped,
    mahn2 as _2nd_reminder_exped,
    mahn3 as _3rd_reminder_exped,
    uebto as overdelivery_tolerance_limit,
    uebtk as unltd_overdelivery,
    untto as underdelivery_tolerance_limit,
    bwtar as valuation_type_id,
    bwtty as valuation_category_id,
    abskz as rejection_indicator,
    agmem as internal_comment_on_quotation_id,
    elikz as delivery_completed,
    erekz as final_invoice_indicator,
    pstyp as item_category_id,
    knttp as account_assignment_category_id,
    kzvbr as consumption_posting,
    vrtkz as distribut_indicator,
    twrkz as partial_invoice_indicator,
    wepos as goods_receipt_indicator,
    weunb as goods_receipt_non_valuated,
    repos as invoice_receipt_indicator,
    webre as gr_based_inv_verif,
    kzabs as order_acknowledgment_requirement,
    labnr as order_acknowledgment_number,
    konnr as outline_agreement_id,
    ktpnr as princ_agreement_item_id,
    {{ char_yyyymmdd_to_date('abdat') }} as reconciliation_date,
    abftz as agreed_cumulative_quantity,
    etfz1 as firm_zone,
    etfz2 as trade_off_zone,
    kzstu as binding_on_mrp,
    notkz as exclusion_indicator,
    lmein as base_uom_id,
    evers as shipping_instruction_id,
    zwert as oa_target_val,
    navnw as non_deductible_put_tax_val,
    abmng as standard_release_order_quantity,
    {{ char_yyyymmdd_to_date('prdat') }} as price_determination_date,
    bstyp as purch_doc_category,
    effwr as effective_item_val,
    xoblr as item_affects_commitments,
    kunnr as customer_id,
    adrnr as address_id,
    ekkol as condition_group_with_vendor,
    sktof as no_cash_discount,
    stafo as update_group_stats_id,
    plifz as planned_delivery_time_in_days,
    ntgew as net_weight,
    gewei as weight_uom_id,
    txjcd as tax_jurisdiction_id,
    etdrk as print_relevant,
    sobkz as special_stock_id,
    arsnr as settlement_reservation_number,
    arsps as item_settlem_reser,
    insnc as not_changeable,
    ssqss as qm_control_key_id,
    zgtyp as certificate_type_id,
    ean11 as ean,
    bstae as confirmation_control_key_id,
    revlv as revision_level,
    geber as fund_id,
    fistl as funds_center_id,
    fipos as commitment_item_id,
    ko_gsber as bus_area_reported_to_partner_id,
    ko_pargb as partners_assumed_bus_area_id,
    ko_prctr as profit_center_id,
    ko_pprctr as partner_profit_center_id,
    meprf as pricing_date_control,
    brgew as gross_weight,
    volum as volume,
    voleh as volume_uom_id,
    inco1 as incoterms_id,
    inco2 as incoterms_part_2,
    vorab as advance_procurement,
    kolif as prior_vendor_id,
    ltsnr as vendor_subrange_id,
    packno as package_number_id,
    fplnr as invoicing_plan_number,
    gnetwr as currently_not_used_val,
    stapo as item_is_statistical,
    uebpo as higher_level_item_id,
    {{ char_yyyymmdd_to_date('lewed') }} as latest_possible_goods_receipt_date,
    emlif as vendor_id,
    lblkz as subcontracting_vendor,
    satnr as cross_plant_cm_id,
    attyp as material_category,
    vsart as shipping_type_id,
    handoverloc as handover_location,
    kanba as kanban_indicator,
    adrn2 as number_delivery_address_id,
    cuobj as internal_object_no,
    xersy as eval_receipt_sett,
    {{ char_yyyymmdd_to_date('eildt') }} as gr_b_settlement_from_date,
    {{ char_yyyymmdd_to_date('drdat') }} as last_transmission_date,
    druhr as tim,
    drunr as sequential_number,
    aktnr as promotion_id,
    abeln as allocation_table_number_id,
    abelp as item_number_allocation_table_id,
    anzpu as number_points,
    punei as points_uom_id,
    saiso as season_category_id,
    saisj as season_year,
    ebon2 as settlement_group_2,
    ebon3 as settlement_group_3,
    ebonf as subseq_settlement,
    mlmaa as mat_ledger_active,
    mhdrz as minimum_remaining_shelf_life,
    anfnr as rfq_number_id,
    anfps as item_number_rfq_id,
    kzkfg as origin_configuration,
    usequ as quota_arrangement_usage_id,
    umsok as sp_ind_stock_tfr_id,
    banfn as purchase_requisition_number,
    bnfpo as item_requisition_id,
    mtart as material_type_id,
    uptyp as subitem_category_id,
    upvor as subitems_exist,
    kzwi1 as subtotal_1_val,
    kzwi2 as subtotal_2_val,
    kzwi3 as subtotal_3_val,
    kzwi4 as subtotal_4_val,
    kzwi5 as subtotal_5_val,
    kzwi6 as subtotal_6_val,
    sikgr as processing_key_sub_items_id,
    mfzhi as maximum_cmg_quantity,
    ffzhi as maximum_cum_pgq,
    retpo as returns_item,
    aurel as relevant_to_allocation_table,
    bsgru as reason_ordering_id,
    lfret as del_type_f_returns_id,
    mfrgr as material_freight_group_id,
    nrfhg as qual_f_freegoodsdis,
    j_1bnbm as brazilian_ncm_code_id,
    j_1bmatuse as usage_the_material,
    j_1bmatorg as origin_the_material,
    j_1bownpro as produced_in_house,
    j_1bindust as material_cfop_category,
    abueb as release_creation_profile_id,
    {{ char_yyyymmdd_to_date('nlabd') }} as next_forecast_delivery_schedule_transm_date,
    {{ char_yyyymmdd_to_date('nfabd') }} as next_jit_delivery_schedule_transmission_date,
    kzbws as special_stock_valuation,
    bonba as rebate_basis_1_val,
    fabkz as jit_sched_indicator,
    j_1aindxp as inflation_index_id,
    {{ char_yyyymmdd_to_date('j_1aidatep') }} as inflation_index_date,
    mprof as mfr_part_profile_id,
    eglkz as final_delivery,
    kztlf as partial_deliv_item,
    kzfme as units_measure_usage,
    rdprf as rounding_profile_id,
    techs as standard_variant,
    chg_srv as configuration_changed,
    chg_fplnr as chg_fplnr,
    mfrpn as manufacturer_part_number,
    mfrnr as manufacturer_number_id,
    emnfr as ext_manufacturer,
    novet as item_blocked_sd_delivery,
    afnam as name_requisitioner_requester,
    tzonrc as time_zone_recipient_location_id,
    iprkz as period_ind_sled,
    lebre as service_based_invoice_verification,
    berid as mrp_area_id,
    xconditions as xconditions,
    apoms as apo_as_planning_system,
    ccomp as stock_transfer_cat,
    grant_nbr as _grant,
    fkber as functional_area_id,
    status as item_status,
    reslo as issuing_storage_loc_id,
    kblnr as earmarked_funds_id,
    kblpos as earmarked_funds_document_item_id,
    weora as acceptance_at_origin,
    srv_bas_com as service_based_commitment,
    prio_urg as requirement_urgency_id,
    prio_req as requirement_priority_id,
    empst as receiving_point,
    diff_invoice as differential_invoicing,
    trmrisk_relevant as risk_relevancy_in_purchasing,
    spe_abgru as reason_rejection,
    spe_crm_so as crm_sales_order_number_tpop_process,
    spe_crm_so_item as crm_sales_order_item_number_in_tpop_proc,
    spe_crm_ref_so as crm_ref_order_number_tpop_process,
    spe_crm_ref_item as crm_reference_item_number_in_tpop_proc,
    spe_crm_fkrel as billing_relevance_crm,
    spe_chng_sys as last_changers_system_type,
    spe_insmk_src as source_stor_loc_stock_type,
    spe_cq_ctrltype as cq_control_type,
    spe_cq_nocq as no_transmission_cqs_in_sa_release,
    reason_code as goods_receipt_reason_code,
    cqu_sar as cumulative_grs_from_redirected_pos,
    anzsn as number_serial_numbers,
    spe_ewm_dtc as ewm_del_tol_chk,
    exlin as item_number_length,
    exsnr as external_sorting,
    ehtyp as external_hierarchy_category_id,
    retpc as retention_in_percent,
    dptyp as down_payment_indicator,
    dppct as down_payment_percentage,
    dpamt as down_payment_amount_val,
    {{ char_yyyymmdd_to_date('dpdat') }} as due_down_payment_date,
    fls_rsto as enh_store_return,
    ext_rfx_number as document_no_external_doc,
    ext_rfx_item as item_number_external_document,
    ext_rfx_system as logical_system_id,
    srm_contract_id as central_contract,
    srm_contract_itm as central_contract_item_number,
    blk_reason_id as blocking_reason_id,
    blk_reason_txt as blocking_reason_text,
    itcons as real_time_cons_post,
    fixmg as delivery_date_and_quantity_fixed,
    wabwe as gi_based_goods_rcpt,
    cmpl_dlv_itm as complete_delivery,
    inco2_l as incoterms_location_1,
    inco3_l as incoterms_location_2,
    tc_aut_det as tax_code_automatically_determined_id,
    manual_tc_reason as manual_tax_code_reason_id,
    fiscal_incentive as tax_incentive_type_id,
    tax_subject_st as tax_subject_to_substituicao_tributaria,
    fiscal_incentive_id as incentive_id,
    sf_txjcd as origin_jurisd_code_id,
    _bev1_negen_item as bev1_indicator_item_is_generated,
    _bev1_nedepfree as bev1_dependent_items_free,
    _bev1_nestruccat as bev1_structure_category,
    advcode as advice_code_id,
    budget_pd as budget_period_id,
    excpe as acceptance_period,
    fmfgus_key as us_government_fields,
    iuid_relevant as iuid_relevant,
    mrpind as max_retail_price_relevant,
    oipipeval as val_ind_pipeline,
    oic_lifnr as oic_lifnr,
    oic_dcityc as destination_city_code_id,
    oic_dcounc as destination_county_code_id,
    oic_dregio as destination_region_id,
    oic_dland1 as destination_country_id,
    oic_ocityc as origin_city_code_id,
    oic_ocounc as origin_county_code_id,
    oic_oregio as origin_region_id,
    oic_oland1 as origin_country_id,
    oic_porgin as tax_origin,
    oic_pdestn as tax_destination,
    oic_ptrip as pipeline_trip_number_external,
    oic_pbatch as pipe_ex_batch_no,
    oic_mot as mode_transport_id,
    oic_aorgin as alternate_origin,
    oic_adestn as alternate_destination,
    oic_truckn as truck_number,
    oia_baselo as base_location,
    oitaxfrom as tax_key_from_id,
    oihantyp as handling_type_id,
    oipricie as ed_pricing_external,
    oitaxto as tax_key_to_id,
    oitaxcon as excise_duty_tax_val,
    oitaxgrp as excise_duty_group_id,
    oioilcon as oil_content_perc,
    oiinex as ed_pricing_key_id,
    oiexgnum as exchange_agreement_number_id,
    oiexgtyp as exchange_type_id,
    oifeetot as fee_total_val,
    {{ char_yyyymmdd_to_date('oifeedt') }} as fee_pricing_condition_date,
    oinetcyc as netting_cycle_id,
    oiferp as fee_repricing_indicator,
    oifeech as fee_edit_control,
    oia_ipmvat as vat_on_int_mat,
    oia_spltiv as split_invoice_verif,
    oivath as loccur_amount,
    oivatf as amount_document_currency_val,
    oisbrel as s_b_prod_relev_ind,
    oibasprod as base_product_number_id,
    oitrknr as tracking_number,
    oitrkjr as tracking_number_year,
    oiextnr as external_tracking_number,
    oiitmnr as tracking_number_item_line,
    oiftind as final_transfer_indicator,
    oipriop as price_opt_gains,
    oitrind as transfer_sign,
    oighndl as gain_handling,
    oiumbar as val_type_issuing_loc_id,
    oitxcon1 as ed_tax_1_val,
    oitxcon2 as ed_tax_2_val,
    oitxcon3 as ed_tax_3_val,
    oitxcon4 as ed_tax_4_val,
    oitxcon5 as ed_tax_5_val,
    oitxcon6 as ed_tax_6_val,
    oid_extbol as external_bill_lading,
    oid_miscdl as miscellaneous_delivery_number,
    oimatcyc as material_inv_cycle_id,
    oiedok as excise_duty_validation_indicator,
    oiedbal as ed_balance_indicator,
    oiedbalm as balance_method_ind,
    oicertf1 as external_license_no,
    {{ char_yyyymmdd_to_date('oidatfm1') }} as valid_from_date,
    {{ char_yyyymmdd_to_date('oidatto1') }} as valid_to_date,
    oih_lictp as license_type_id,
    oih_licin as internal_license_no_id,
    oih_lcfol as follow_on_license_id,
    oih_folqty as _2nd_license_qty,
    oiedok_gi as ed_validation,
    oiedbal_gi as excise_duty_balance,
    oiedbalm_gi as balance_method,
    oihantyp_gi as oihantyp_gi,
    oiinex_gi as oiinex_gi,
    oitaxgrp_gi as oitaxgrp_gi,
    oicertf1_gi as ext_license_no_gi,
    {{ char_yyyymmdd_to_date('oidatfm1_gi') }} as oidatfm1_gi,
    {{ char_yyyymmdd_to_date('oidatto1_gi') }} as oidatto1_gi,
    oih_lictp_gi as license_type_to_material_sto_id,
    oih_licin_gi as inter_license_no_to_id,
    oih_lcfol_gi as oih_lcfol_gi,
    oih_folqty_gi as oih_folqty_gi,
    sgt_scat as stock_segment,
    sgt_rcat as requirement_segment,
    wrf_charstc1 as characteristic_value_1,
    wrf_charstc2 as characteristic_value_2,
    wrf_charstc3 as characteristic_value_3,
    refsite as reference_site_purchasing,
    _accgo_is_co_rel as accgo_call_off_applies,
    serru as type_subcontracting,
    sernp as serial_number_profile_id,
    disub_sobkz as special_stock,
    disub_pspnr as wbs_element_id,
    disub_kunnr as disub_kunnr,
    disub_vbeln as sales_document_id,
    disub_posnr as sd_item_id,
    disub_owner as owner_stock_id,
    fsh_season_year as fsh_season_year,
    fsh_season as season_id,
    fsh_collection as fashion_collection,
    fsh_theme as fashion_theme,
    {{ char_yyyymmdd_to_date('fsh_atp_date') }} as starting_with_atp_date,
    fsh_vas_rel as vas_relevant,
    fsh_vas_prnt_id as fsh_vas_prnt_id,
    fsh_transaction as transaction_number,
    fsh_item_group as item_group,
    fsh_item as item_number,
    fsh_ss as order_scheduling_strategy,
    fsh_grid_cond_rec as grid_condition_number,
    fsh_psm_pfm_split as psm_and_pfm_split_id,
    cnfm_qty as committed_quantity,
    ref_item as reference_item_id,
    source_id as origin_profile_id,
    source_key as key_in_source_system,
    put_back as put_back_indicator,
    pol_id as order_list_item_number,
    cons_order as purchase_order_consignment,
    hvr_is_deleted as hvr_is_deleted,
    hvr_change_time as hvr_change_time
from {{ ref('stg_sap__ekpo') }}
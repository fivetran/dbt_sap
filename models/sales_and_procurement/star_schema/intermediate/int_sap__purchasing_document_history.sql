{{ config(enabled=var('sap_using_ekbe', True)) }}

select
    mandt as client_id,
    ebeln as purchasing_document_id,
    ebelp as purchasing_document_item_id,
    zekkn as seq_no_account_assgt_id,
    vgabe as trans_event_type_id,
    gjahr as material_document_year_id,
    belnr as material_document_id,
    buzei as item_in_material_document_id,
    bewtp as purchase_order_history_category_id,
    bwart as movement_type_id,
    {{ char_yyyymmdd_to_date('budat') }} as posting_in_the_document_date,
    menge as qty,
    bpmng as quantity_in_opun,
    dmbtr as loccur_amount,
    wrbtr as amount_document_currency_val,
    waers as currency_id,
    arewr as gr_ir_clearg_local_currency_val,
    wesbs as gr_blck_stock_in_oun,
    bpwes as gr_blocked_stck_opun,
    shkzg as debitcredit_indicator,
    bwtar as valuation_type_id,
    elikz as delivery_completed,
    xblnr as reference_document_number,
    lfgja as fisc_year_ref_doc,
    lfbnr as reference_document,
    lfpos as item_reference_document,
    grund as reason_movement_id,
    {{ char_yyyymmdd_to_date('cpudt') }} as entry_date,
    cputm as entry_tim,
    reewr as voice_val,
    evere as compliance_with_shipping_instr_id,
    refwr as voice_fc_val,
    matnr as material_id,
    werks as plant_id,
    xwsbr as revgr_despite_ir,
    etens as sequential_number,
    knumv as document_condition_no,
    mwskz as tax_code_id,
    lsmng as del_note_quantity,
    lsmeh as delivery_note_uom_id,
    ematn as material_number_id,
    areww as gr_ir_clearg_fc_val,
    hswae as local_currency_key_id,
    bamng as bamng,
    charg as batch_id,
    {{ char_yyyymmdd_to_date('bldat') }} as document_in_document_date,
    xwoff as calculation_val_open,
    xunpl as unplanned_acct_assgmt_inv_verification,
    ernam as created_by,
    srvpos as service_number_id,
    packno as package_number_service_id,
    introw as line_number_service,
    bekkn as number_po_account_assignment,
    lemin as returns_indicator,
    arewb as arewb,
    rewrb as voice_amount_po_currency_val,
    saprl as sap_release,
    menge_pop as menge_pop,
    bpmng_pop as bpmng_pop,
    dmbtr_pop as dmbtr_pop,
    wrbtr_pop as wrbtr_pop,
    wesbb as val_gr_blocked_stock_in_oun,
    bpweb as valuated_gr_blocked_stock_in_opun,
    weora as acceptance_at_origin,
    arewr_pop as arewr_pop,
    kudif as exchange_rate_difference_amount_val,
    retamt_fc as retention_document_currency_val,
    retamt_lc as retention_company_code_currency_val,
    retamtp_fc as posted_retention_document_currency_val,
    retamtp_lc as posted_security_retention_cc_crcy_val,
    xmacc as multiple_account_assignment,
    wkurs as exchange_rate,
    inv_item_origin as origin_an_invoice_item,
    vbeln_st as delivery_id,
    vbelp_st as delivery_item_id,
    sgt_scat as stock_segment,
    et_upd as slqupd,
    j_sc_die_comp_f as depreciation_completion_flag,
    fsh_season_year as season_year,
    fsh_season as season_id,
    fsh_collection as fashion_collection,
    fsh_theme as fashion_theme,
    wrf_charstc1 as characteristic_value_1,
    wrf_charstc2 as characteristic_value_2,
    wrf_charstc3 as characteristic_value_3,
    hvr_is_deleted as hvr_is_deleted,
    hvr_change_time as hvr_change_time
from {{ ref('stg_sap__ekbe') }}
where mandt in ('800')
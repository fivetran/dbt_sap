{{ config(enabled=var('sap_using_marc', True)) }}

{% set source_columns = adapter.get_columns_in_relation(ref('stg_sap__marc_tmp')) %}

with base as (
    select {{ remove_slashes_from_col_names(source_columns) }}
    from {{ ref('stg_sap__marc_tmp') }}
),

fields as (
    select
        {{
            fivetran_utils.fill_staging_columns(
                source_columns=source_columns,
                staging_columns=get_marc_columns()
            )
        }}
    from base
),

final as (
    select
        _cwm_bwesb,
        _cwm_trame,
        _cwm_umlmc,
        _fivetran_deleted,
        _fivetran_sap_archived,
        _fivetran_synced,
        _sapmp_tolprmi,
        _sapmp_tolprpl,
        _sttpec_servalid,
        _vso_r_fork_dir,
        _vso_r_lane_num,
        _vso_r_pal_vend,
        _vso_r_pkgrp,
        abcin,
        abfac,
        ahdis,
        altsl,
        aplal,
        apokz,
        arun_fix_batch,
        atpkz,
        auftl,
        ausdt,
        ausme,
        ausss,
        autru,
        awsls,
        basmg,
        bearz,
        beskz,
        bstfe,
        bstma,
        bstmi,
        bstrf,
        bwesb,
        bwscl,
        bwtty,
        casnr,
        ccfix,
        compl,
        conf_gmsync,
        cons_procg,
        convt,
        copam,
        cuobj,
        cuobv,
        diber,
        disgr,
        disls,
        dismm,
        dispo,
        dispr,
        dpcbt,
        dplfs,
        dplho,
        dplpu,
        dummy_plnt_incl_eew_ps,
        dzeit,
        eisbe,
        eislo,
        ekgrp,
        eprio,
        esppflg,
        excise_tax_rlvnce,
        expme,
        fabkz,
        fevor,
        ffrei,
        fhori,
        fixls,
        fprfm,
        frtme,
        fsh_calendar_group,
        fsh_kzech,
        fsh_mg_arun_req,
        fsh_seaim,
        fsh_var_group,
        fvidk,
        fxhor,
        fxpru,
        gi_pr_time,
        glgmg,
        gpmkz,
        gpnum,
        herbl,
        herkl,
        herkr,
        indus,
        insmk,
        itark,
        iuid_relevant,
        iuid_type,
        jitprodnconfprofile,
        kausf,
        kautb,
        kordb,
        kzagl,
        kzaus,
        kzbed,
        kzdie,
        kzdkz,
        kzech,
        kzkfk,
        kzkri,
        kzkup,
        kzppv,
        kzpro,
        kzpsp,
        ladgr,
        lagpr,
        cast(lfgja as {{ dbt.type_string() }}) as lfgja,
        cast(lfmon as {{ dbt.type_string() }}) as lfmon,
        lfrhy,
        lgfsb,
        lgpro,
        lgrad,
        lizyk,
        loggr,
        losfx,
        losgr,
        ltinc,
        lvorm,
        lzeih,
        maabc,
        mabst,
        cast(mandt as {{ dbt.type_string() }}) as mandt,
        matgr,
        cast(matnr as {{ dbt.type_string() }}) as matnr,
        max_troc,
        maxls,
        maxlz,
        mcrue,
        mdach,
        megru,
        mfrgr,
        min_troc,
        minbe,
        minls,
        miskz,
        mmsta,
        mmstd,
        mogru,
        mownr,
        mpdau,
        mrppp,
        mtver,
        mtvfp,
        multiple_ekgrp,
        ncost,
        nf_flag,
        nfmat,
        nkmpr,
        objid,
        ocmpf,
        otype,
        periv,
        perkz,
        pfrei,
        plifz,
        plnnr,
        plnty,
        plvar,
        ppskz,
        prctr,
        prefe,
        prenc,
        prend,
        prene,
        preng,
        preno,
        prfrq,
        profil,
        pstat,
        qmata,
        qmatv,
        qssys,
        quazt,
        qzgtp,
        rdprf,
        ref_schema,
        resvp,
        rgekz,
        rotation_date,
        ruezt,
        rwpro,
        sauft,
        sbdkz,
        schgt,
        scm_conhap,
        scm_conhap_out,
        scm_coninp,
        scm_fixpeg_prod_set,
        scm_ges_bst_use,
        scm_ges_mng_use,
        scm_get_alerts,
        scm_giprt,
        scm_grprt,
        scm_heur_id,
        scm_hunit,
        scm_hunit_out,
        scm_intsrc_prof,
        scm_iunit,
        scm_lsuom,
        scm_matlocid_guid16,
        scm_matlocid_guid22,
        scm_maturity_dur,
        scm_maxstock_v,
        scm_min_pass_amount,
        scm_ndcostwa,
        scm_ndcostwe,
        scm_package_id,
        scm_peg_future_alert,
        scm_peg_past_alert,
        scm_peg_strategy,
        scm_peg_wo_alert_fst,
        scm_ppsaftystk,
        scm_ppsaftystk_v,
        scm_prio,
        scm_proc_cost,
        scm_profid,
        scm_reldt,
        scm_reord_dur,
        scm_reord_v,
        scm_repsafty,
        scm_repsafty_v,
        scm_res_net_name,
        scm_rrp_sel_group,
        scm_rrp_type,
        scm_safty_v,
        scm_scost,
        scm_scost_prcnt,
        scm_sft_lock,
        scm_shelf_life_dur,
        scm_shelf_life_loc,
        scm_shlf_lfe_req_max,
        scm_shlf_lfe_req_min,
        scm_sspen,
        scm_stra1,
        scm_target_dur,
        scm_thruput_time,
        scm_tpop,
        scm_tstrid,
        scm_whatbom,
        sernp,
        servg,
        sfcpf,
        sfepr,
        sfty_stk_meth,
        sgt_chint,
        sgt_covs,
        sgt_defsc,
        sgt_mmstd,
        sgt_mrp_atp_status,
        sgt_mrpsi,
        sgt_prcm,
        sgt_scope,
        sgt_statc,
        sgt_stk_prt,
        shflg,
        shpro,
        shzet,
        sobsk,
        sobsl,
        sproz,
        ssqss,
        stawn,
        stdpd,
        steuc,
        stlal,
        stlan,
        strgr,
        takzt,
        target_stock,
        temp_ctrl_max,
        temp_ctrl_min,
        temp_uom,
        trame,
        tranz,
        uchkz,
        ucmat,
        ueetk,
        ueeto,
        uid_iea,
        umlmc,
        umrsl,
        uneto,
        uomgr,
        usequ,
        vbamg,
        vbeaz,
        verkz,
        vint1,
        vint2,
        vkglg,
        vktrw,
        vkumc,
        vrbdt,
        vrbfk,
        vrbmt,
        vrbwk,
        vrmod,
        vrvez,
        vspvb,
        vzusl,
        webaz,
        cast(werks as {{ dbt.type_string() }}) as werks,
        wstgh,
        wzeit,
        xchar,
        xchpf,
        xmcng
    from fields
)

select *
from final

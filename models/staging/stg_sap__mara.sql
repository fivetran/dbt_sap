{{ config(enabled=var('sap_using_mara', True)) }}

{% set source_columns = adapter.get_columns_in_relation(ref('stg_sap__mara_tmp')) %}

with base as (

    select {{ remove_slashes_from_col_names(source_columns) }}
    from {{ ref('stg_sap__mara_tmp') }}
),

fields as (

    select
        {{
            fivetran_utils.fill_staging_columns(
                source_columns=source_columns,
                staging_columns=get_mara_columns()
            )
        }}
    from base
),

final as (

    select
        _accgo_assgd_uom,
        _bev1_luldegrp,
        _bev1_luleinh,
        _bev1_nestruccat,
        _dsd_sl_toltyp,
        _dsd_sv_cnt_grp,
        _dsd_vc_group,
        _sttpec_country_ref,
        _sttpec_prdcat,
        _sttpec_sertype,
        _sttpec_syncact,
        _sttpec_syncchg,
        _sttpec_synctime,
        _vso_r_bot_ind,
        _vso_r_kzgvh_ind,
        _vso_r_no_p_gvh,
        _vso_r_pal_b_ht,
        _vso_r_pal_ind,
        _vso_r_pal_min_h,
        _vso_r_pal_ovr_d,
        _vso_r_pal_ovr_w,
        _vso_r_quan_unit,
        _vso_r_stack_ind,
        _vso_r_stack_no,
        _vso_r_tilt_ind,
        _vso_r_tol_b_ht,
        _vso_r_top_ind,
        cast(mandt as {{ dbt.type_string() }}) as mandt,
        cast(matnr as {{ dbt.type_string() }}) as matnr,
        ersda,
        ernam,
        laeda,
        aenam,
        vpsta,
        pstat,
        lvorm,
        mtart,
        mbrsh,
        matkl,
        bismt,
        meins,
        bstme,
        zeinr,
        zeiar,
        zeivr,
        zeifo,
        aeszn,
        blatt,
        blanz,
        ferth,
        formt,
        groes,
        wrkst,
        normt,
        labor,
        ekwsl,
        brgew,
        ntgew,
        gewei,
        volum,
        voleh,
        behvo,
        raube,
        tempb,
        disst,
        tragr,
        stoff,
        spart,
        cast(kunnr as {{ dbt.type_string() }}) as kunnr,
        eannr,
        wesch,
        bwvor,
        bwscl,
        saiso,
        etiar,
        etifo,
        entar,
        ean11,
        numtp,
        laeng,
        breit,
        hoehe,
        meabm,
        prdha,
        aeklk,
        cadkz,
        qmpur,
        ergew,
        ergei,
        ervol,
        ervoe,
        gewto,
        volto,
        vabme,
        kzrev,
        kzkfg,
        xchpf,
        vhart,
        fuelg,
        stfak,
        magrv,
        begru,
        datab,
        liqdt,
        saisj,
        plgtp,
        mlgut,
        extwg,
        satnr,
        attyp,
        kzkup,
        kznfm,
        pmata,
        mstae,
        mstav,
        mstde,
        mstdv,
        taklv,
        rbnrm,
        mhdrz,
        mhdhb,
        mhdlp,
        inhme,
        inhal,
        vpreh,
        etiag,
        inhbr,
        cmeth,
        cuobf,
        kzumw,
        kosch,
        sprof,
        nrfhg,
        mfrpn,
        mfrnr,
        bmatn,
        mprof,
        kzwsm,
        saity,
        profl,
        ihivi,
        iloos,
        serlv,
        kzgvh,
        xgchp,
        kzeff,
        compl,
        iprkz,
        rdmhd,
        przus,
        mtpos_mara,
        bflme,
        nsnid,
        retdelc,
        _fivetran_rowid,
        _fivetran_deleted,
        _fivetran_synced,
        _fivetran_sap_archived,
        adprof,
        adspc_spc,
        allow_pmat_igno,
        animal_origin,
        anp,
        bbtyp,
        brand_id,
        bstat,
        care_code,
        cmrel,
        cobjid,
        color,
        color_atinn,
        commodity,
        cotype,
        cwqproc,
        cwqrel,
        cwqtolgr,
        dg_pack_status,
        fashgrd,
        fiber_code1,
        fiber_code2,
        fiber_code3,
        fiber_code4,
        fiber_code5,
        fiber_part1,
        fiber_part2,
        fiber_part3,
        fiber_part4,
        fiber_part5,
        free_char,
        fsh_mg_at1,
        fsh_mg_at2,
        fsh_mg_at3,
        fsh_sc_mid,
        fsh_seaim,
        fsh_sealv,
        gds_relevant,
        gennr,
        gtin_variant,
        hazmat,
        herkl,
        hndlcode,
        hutyp,
        hutyp_dflt,
        imatn,
        ipmipproduct,
        loglev_reto,
        logunit,
        matfi,
        maxb,
        maxc,
        maxc_tol,
        maxdim_uom,
        maxh,
        maxl,
        mcond,
        medium,
        mfrgr,
        oigroupnam,
        oihmtxgr,
        oitrind,
        packcode,
        picnum,
        pilferable,
        ps_smartform,
        psm_code,
        qgrp,
        qqtime,
        qqtimeuom,
        rmatp,
        serial,
        sgt_covsa,
        sgt_csgr,
        sgt_rel,
        sgt_scope,
        sgt_stat,
        size1,
        size1_atinn,
        size2,
        size2_atinn,
        sled_bbd,
        tare_var,
        textile_comp_ind,
        weora,
        whmatgr,
        whstc
    from fields
)

select *
from final

{{ config(enabled=var('sap_using_ekpo', True)) }}

{% set source_columns = adapter.get_columns_in_relation(ref('stg_sap__ekpo_tmp')) %}

with base as (
    select {{ remove_slashes_from_col_names(source_columns) }}
    from {{ ref('stg_sap__ekpo_tmp') }}
),

fields as (
    select
        {{
            fivetran_utils.fill_staging_columns(
                source_columns=source_columns,
                staging_columns=get_ekpo_columns()
            )
        }}
    from base
),

final as (
    select
        _accgo_is_co_rel,
        _bev1_nedepfree,
        _bev1_negen_item,
        _bev1_nestruccat,
        abdat,
        abeln,
        abelp,
        abftz,
        abmng,
        abskz,
        abueb,
        adrn2,
        adrnr,
        advcode,
        aedat,
        afnam,
        agdat,
        agmem,
        aktnr,
        anfnr,
        anfps,
        anzpu,
        anzsn,
        apoms,
        arsnr,
        arsps,
        attyp,
        aurel,
        banfn,
        bednr,
        berid,
        blk_reason_id,
        blk_reason_txt,
        bnfpo,
        bonba,
        bonus,
        bprme,
        bpumn,
        bpumz,
        brgew,
        brtwr,
        bsgru,
        bstae,
        bstyp,
        budget_pd,
        cast(bukrs as {{ dbt.type_string() }}) as bukrs,
        bwtar,
        bwtty,
        ccomp,
        chg_fplnr,
        chg_srv,
        cmpl_dlv_itm,
        cnfm_qty,
        cons_order,
        cqu_sar,
        cuobj,
        diff_invoice,
        disub_kunnr,
        disub_owner,
        disub_posnr,
        disub_pspnr,
        disub_sobkz,
        disub_vbeln,
        dpamt,
        dpdat,
        dppct,
        dptyp,
        drdat,
        druhr,
        drunr,
        ean11,
        cast(ebeln as {{ dbt.type_string() }}) as ebeln,
        cast(ebelp as {{ dbt.type_string() }}) as ebelp,
        ebon2,
        ebon3,
        ebonf,
        effwr,
        eglkz,
        ehtyp,
        eildt,
        ekkol,
        elikz,
        ematn,
        emlif,
        emnfr,
        empst,
        erekz,
        etdrk,
        etfz1,
        etfz2,
        evers,
        excpe,
        exlin,
        exsnr,
        ext_rfx_item,
        ext_rfx_number,
        ext_rfx_system,
        fabkz,
        ffzhi,
        fipos,
        fiscal_incentive,
        fiscal_incentive_id,
        fistl,
        fixmg,
        fkber,
        fls_rsto,
        fmfgus_key,
        fplnr,
        fsh_atp_date,
        fsh_collection,
        fsh_grid_cond_rec,
        fsh_item,
        fsh_item_group,
        fsh_psm_pfm_split,
        fsh_season,
        fsh_season_year,
        fsh_ss,
        fsh_theme,
        fsh_transaction,
        fsh_vas_prnt_id,
        fsh_vas_rel,
        geber,
        gewei,
        gnetwr,
        grant_nbr,
        handoverloc,
        hvr_change_time,
        hvr_is_deleted,
        idnlf,
        inco1,
        inco2,
        inco2_l,
        inco3_l,
        infnr,
        insmk,
        insnc,
        iprkz,
        itcons,
        iuid_relevant,
        j_1aidatep,
        j_1aindxp,
        j_1bindust,
        j_1bmatorg,
        j_1bmatuse,
        j_1bnbm,
        j_1bownpro,
        kanba,
        kblnr,
        kblpos,
        knttp,
        ko_gsber,
        ko_pargb,
        ko_pprctr,
        ko_prctr,
        kolif,
        konnr,
        ktmng,
        ktpnr,
        cast(kunnr as {{ dbt.type_string() }}) as kunnr,
        kzabs,
        kzbws,
        kzfme,
        kzkfg,
        kzstu,
        kztlf,
        kzvbr,
        kzwi1,
        kzwi2,
        kzwi3,
        kzwi4,
        kzwi5,
        kzwi6,
        labnr,
        lblkz,
        lebre,
        lewed,
        lfret,
        lgort,
        lmein,
        loekz,
        ltsnr,
        mahn1,
        mahn2,
        mahn3,
        mahnz,
        cast(mandt as {{ dbt.type_string() }}) as mandt,
        manual_tc_reason,
        matkl,
        cast(matnr as {{ dbt.type_string() }}) as matnr,
        meins,
        cast(menge as {{ dbt.type_numeric() }}) as menge,
        meprf,
        mfrgr,
        mfrnr,
        mfrpn,
        mfzhi,
        mhdrz,
        mlmaa,
        mprof,
        mrpind,
        mtart,
        mwskz,
        navnw,
        netpr,
        cast(netwr as {{ dbt.type_numeric() }}) as netwr,
        nfabd,
        nlabd,
        notkz,
        novet,
        nrfhg,
        ntgew,
        oia_baselo,
        oia_ipmvat,
        oia_spltiv,
        oibasprod,
        oic_adestn,
        oic_aorgin,
        oic_dcityc,
        oic_dcounc,
        oic_dland1,
        oic_dregio,
        oic_lifnr,
        oic_mot,
        oic_ocityc,
        oic_ocounc,
        oic_oland1,
        oic_oregio,
        oic_pbatch,
        oic_pdestn,
        oic_porgin,
        oic_ptrip,
        oic_truckn,
        oicertf1,
        oicertf1_gi,
        oid_extbol,
        oid_miscdl,
        oidatfm1,
        oidatfm1_gi,
        oidatto1,
        oidatto1_gi,
        oiedbal,
        oiedbal_gi,
        oiedbalm,
        oiedbalm_gi,
        oiedok,
        oiedok_gi,
        oiexgnum,
        oiexgtyp,
        oiextnr,
        oifeech,
        oifeedt,
        oifeetot,
        oiferp,
        oiftind,
        oighndl,
        oih_folqty,
        oih_folqty_gi,
        oih_lcfol,
        oih_lcfol_gi,
        oih_licin,
        oih_licin_gi,
        oih_lictp,
        oih_lictp_gi,
        oihantyp,
        oihantyp_gi,
        oiinex,
        oiinex_gi,
        oiitmnr,
        oimatcyc,
        oinetcyc,
        oioilcon,
        oipipeval,
        oipricie,
        oipriop,
        oisbrel,
        oitaxcon,
        oitaxfrom,
        oitaxgrp,
        oitaxgrp_gi,
        oitaxto,
        oitrind,
        oitrkjr,
        oitrknr,
        oitxcon1,
        oitxcon2,
        oitxcon3,
        oitxcon4,
        oitxcon5,
        oitxcon6,
        oiumbar,
        oivatf,
        oivath,
        packno,
        peinh,
        plifz,
        pol_id,
        prdat,
        prio_req,
        prio_urg,
        prsdr,
        pstyp,
        punei,
        put_back,
        rdprf,
        reason_code,
        ref_item,
        refsite,
        repos,
        reslo,
        retpc,
        retpo,
        revlv,
        saisj,
        saiso,
        satnr,
        schpr,
        sernp,
        serru,
        sf_txjcd,
        sgt_rcat,
        sgt_scat,
        sikgr,
        sktof,
        sobkz,
        source_id,
        source_key,
        spe_abgru,
        spe_chng_sys,
        spe_cq_ctrltype,
        spe_cq_nocq,
        spe_crm_fkrel,
        spe_crm_ref_item,
        spe_crm_ref_so,
        spe_crm_so,
        spe_crm_so_item,
        spe_ewm_dtc,
        spe_insmk_src,
        spinf,
        srm_contract_id,
        srm_contract_itm,
        srv_bas_com,
        ssqss,
        stafo,
        stapo,
        statu,
        status,
        tax_subject_st,
        tc_aut_det,
        techs,
        trmrisk_relevant,
        twrkz,
        txjcd,
        txz01,
        tzonrc,
        uebpo,
        uebtk,
        uebto,
        umren,
        umrez,
        umsok,
        untto,
        uptyp,
        upvor,
        usequ,
        voleh,
        volum,
        vorab,
        vrtkz,
        vsart,
        wabwe,
        webaz,
        webre,
        weora,
        wepos,
        werks,
        weunb,
        wrf_charstc1,
        wrf_charstc2,
        wrf_charstc3,
        xconditions,
        xersy,
        xoblr,
        zgtyp,
        zwert
    from fields
)

select *
from final

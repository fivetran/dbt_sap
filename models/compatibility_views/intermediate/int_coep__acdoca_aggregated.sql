{{ config(enabled=(var('sap_using_acdoca', True) and var('sap_using_finsc_cmp_versnd', True) and var('sap_using_tka01', True))) }}

with base as (

    select *
    from {{ ref('int_coep__acdoca_calculated') }}

)

select
    mandt,
    kokrs,
    belnr,
    buzei,
    versn,
    budat,
    perio,
    lednr,
    objnr,
    gjahr,
    wrttp,
    kstar,
    hrkft,
    vrgng,
    parob,
    parob1,
    uspob,
    vbund,
    pargb,
    beknz,
    twaer,
    owaer,
    meinh,
    meinb,
    bukrs,
    pkstar,
    pbukrs,
    awtyp,
    awkey,
    awsys,
    kwaer,
    accas,
    accasty,
    paccas,
    paccasty,
    qunit1,
    qunit2,
    qunit3,
    co_accasty_n1,
    co_accasty_n2,
    co_accasty_n3,
    sum(wtgbtr) as wtgbtr,
    sum(wogbtr) as wogbtr,
    sum(wkgbtr) as wkgbtr,
    sum(wkfbtr) as wkfbtr,
    sum(pagbtr) as pagbtr,
    sum(pafbtr) as pafbtr,
    sum(megbtr) as megbtr,
    sum(mefbtr) as mefbtr,
    sum(mbgbtr) as mbgbtr,
    sum(mbfbtr) as mbfbtr,
    max(muvflg) as muvflg,
    max(sgtxt) as sgtxt,
    max(refbz) as refbz,
    max(zlenr) as zlenr,
    max(bw_refbz) as bw_refbz,
    max(gkont) as gkont,
    max(gkoar) as gkoar,
    max(werks) as werks,
    max(matnr) as matnr,
    max(rbest) as rbest,
    max(ebeln) as ebeln,
    max(ebelp) as ebelp,
    max(zekkn) as zekkn,
    max(erlkz) as erlkz,
    max(pernr) as pernr,
    max(paobjnr) as paobjnr,
    max(beltp) as beltp,
    max(gsber) as gsber,
    max(fkber) as fkber,
    max(scope) as scope,
    max(logsyso) as logsyso,
    max(pfkber) as pfkber,
    max(pscope) as pscope,
    max(logsysp) as logsysp,
    max(dabrz) as dabrz,
    max(bwstrat) as bwstrat,
    max(objnr_hk) as objnr_hk,
    max(timestamp) as timestamp,
    max(qmnum) as qmnum,
    max(geber) as geber,
    max(pgeber) as pgeber,
    max(grant_nbr) as grant_nbr,
    max(pgrant_nbr) as pgrant_nbr,
    max(refbz_fi) as refbz_fi,
    max(segment) as segment,
    max(psegment) as psegment,
    max(posnr) as posnr,
    max(prctr) as prctr,
    max(pprct) as pprct,
    max(budget_pd) as budget_pd,
    max(pbudget_pd) as pbudget_pd,
    max(prodper) as prodper,
    max(kostl) as kostl,
    max(lstar) as lstar,
    max(aufnr) as aufnr,
    max(autyp) as autyp,
    max(pspnr) as pspnr,
    max(pspid) as pspid,
    max(vbeln) as vbeln,
    max(vbposnr) as vbposnr,
    max(ce4key) as ce4key,
    max(erkrs) as erkrs,
    max(pkostl) as pkostl,
    max(plstar) as plstar,
    max(paufnr) as paufnr,
    max(pautyp) as pautyp,
    max(ppspnr) as ppspnr,
    max(ppspid) as ppspid,
    max(pvbeln) as pvbeln,
    max(pvbposnr) as pvbposnr,
    max(pce4key) as pce4key,
    sum(quant1) as quant1,
    sum(quant2) as quant2,
    sum(quant3) as quant3

from base
{{ dbt_utils.group_by(n=41) }}
